{% load static %}
<!DOCTYPE html>
<html class="dark" lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>{% block title %}SUPER-FACTU | Espace Client{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background-image: 
                linear-gradient(to bottom, rgba(10, 10, 12, 0.8), rgba(10, 10, 12, 0.95)),
                url("{% static 'img/fond_supermarche.jpeg' %}");
            background-attachment: fixed;
            background-size: cover;
        }
        .sidebar-item-active {
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.15) 0%, transparent 100%);
            border-left: 4px solid #2563eb;
            color: #00f2ff !important;
        }
        /* Style pour la surface sombre si non définie par tailwind config */
        .bg-surface-dark {
            background-color: #161b22;
        }
    </style>
</head>
<body class="text-white antialiased flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="w-64 bg-surface-dark/80 backdrop-blur-md border-r border-white/5 flex flex-col h-full shrink-0">
        <div class="p-6 flex items-center gap-3">
            <div class="size-8 bg-electric-blue rounded flex items-center justify-center text-white" style="background-color: #2563eb;">
                <span class="material-symbols-outlined text-xl">storefront</span>
            </div>
            <h1 class="text-white text-lg font-black tracking-tighter">SUPER-FACTU</h1>
        </div>

        <nav class="flex-1 px-4 py-4 space-y-1">
            <!-- Tableau de bord -->
            <a href="{% url 'client_dashboard' %}" class="flex items-center gap-3 px-4 py-3 rounded transition-all {% if active_menu == 'dashboard' %}sidebar-item-active{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                <span class="material-symbols-outlined">dashboard</span> 
                <span class="text-sm font-bold">Tableau de bord</span>
            </a>

            <!-- Achats -->
            <a href="{% url 'achats_client' %}" class="flex items-center gap-3 px-4 py-3 rounded transition-all {% if active_menu == 'achats' %}sidebar-item-active text-blue-500 font-bold{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                <span class="material-symbols-outlined">shopping_bag</span> 
                <span class="text-sm font-bold">Achats</span>
            </a>

            <!-- Stocks -->
            <a href="{% url 'client_stocks' %}" class="flex items-center gap-3 px-4 py-3 rounded transition-all {% if active_menu == 'stocks' %}sidebar-item-active text-blue-500 font-bold{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                <span class="material-symbols-outlined text-[20px]">inventory_2</span>
                <span class="text-sm font-medium">Stocks Personnel</span>
            </a>

            <!-- Facturations -->
            <a href="{% url 'facturations_client' %}" class="flex items-center gap-3 px-4 py-3 rounded transition-all {% if active_menu == 'facturations' %}sidebar-item-active text-blue-500 font-bold{% else %}text-slate-400 hover:text-white hover:bg-white/5{% endif %}">
                <span class="material-symbols-outlined text-[20px]">receipt_long</span> 
                <span class="text-sm font-bold">Facturations</span>
            </a>
        </nav>

        <div class="mt-auto p-4">
            <!-- Profil Utilisateur -->
            <div class="p-4 border-t border-white/5 mb-2 flex items-center gap-3">
                <div class="size-10 rounded-full bg-blue-600/20 flex items-center justify-center text-blue-500 font-bold border border-blue-500/30">
                    {{ request.user.username|slice:":2"|upper }}
                </div>
                <div class="overflow-hidden">
                    <p class="text-xs font-bold truncate">{{ request.user.get_full_name|default:request.user.username }}</p>
                    <p class="text-[10px] text-slate-500 truncate">{{ request.user.email }}</p>
                </div>
            </div>
            
            <!-- Lien Déconnexion modifié pour ouvrir la modal -->
            <a href="javascript:void(0)" onclick="toggleLogoutModal(true)" class="flex items-center gap-3 px-4 py-3 text-red-500 hover:bg-red-500/10 rounded-xl transition-all font-bold text-sm">
                <span class="material-symbols-outlined">logout</span> 
                <span class="text-sm font-bold">Déconnexion</span>
            </a>
        </div>
    </aside>

    <!-- Contenu Principal -->
    <main class="flex-1 flex flex-col overflow-hidden">
        {% block content %}{% endblock %}
    </main>

    <!-- FENÊTRE DE CONFIRMATION DE DÉCONNEXION (MODAL) -->
    <div id="logoutModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm transition-all">
        <div class="bg-[#161b22] border border-white/10 rounded-2xl max-w-sm w-full p-6 shadow-2xl transform transition-all">
            <div class="size-14 bg-red-500/20 rounded-full flex items-center justify-center text-red-500 mb-4 mx-auto">
                <span class="material-symbols-outlined text-3xl">logout</span>
            </div>
            
            <h3 class="text-xl font-bold text-center text-white mb-2">Déconnexion ?</h3>
            <p class="text-slate-400 text-center text-sm mb-8">Souhaitez-vous vraiment quitter votre session SUPER-FACTU ?</p>
            
            <div class="flex gap-3">
                <button onclick="toggleLogoutModal(false)" class="flex-1 px-4 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-sm font-bold transition-all border border-white/5">
                    Annuler
                </button>
                <a href="{% url 'logout' %}" class="flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 rounded-xl text-sm font-bold transition-all text-center shadow-lg shadow-red-600/20">
                    Se déconnecter
                </a>
            </div>
        </div>
    </div>

    <!-- Script pour la modal -->
    <script>
        function toggleLogoutModal(show) {
            const modal = document.getElementById('logoutModal');
            if (show) {
                modal.classList.remove('hidden');
                // Empêcher le scroll du body quand la modal est ouverte
                document.body.style.overflow = 'hidden';
            } else {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        // Fermer la modal si on clique en dehors du cadre blanc
        window.onclick = function(event) {
            const modal = document.getElementById('logoutModal');
            if (event.target == modal) {
                toggleLogoutModal(false);
            }
        }
    </script>

</body>
</html>